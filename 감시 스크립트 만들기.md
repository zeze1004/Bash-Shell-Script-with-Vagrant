# 감시 스크립트 만들기



## 쉘 스크립트 작성 흐름

1. 실행 후 얻을 결과를 구체적으로 나열
2. 각 과정별 명령어를 나열
3. 명령어를 순차대로 파일에 써주고 실행

## 주요 사용 명령어

- df -f
- du
- crontab
  - 스케줄러 옵션
  - -r: 스케줄러 삭제므로 주의할 것
- awk 응용



## 처리 스크립트

### 로그 디렉토리 용량 감시 스크립트

- 스크립트가 해야 할 일
  - 로그 디렉토리의 크기를 확인하고 지정한 용량보다 크면 관리자에게 알람을 보냄
- 처리 과정의 정리 및 명령어
  - 로그 디렉토리의 크기를 확인 (du)
  - 크기를 비교해서 처리 (if)
  - 관리자에게 알림
    - telegram
      - API가 간단한 장점
  - 스크립트 작성
  - 테스트



포트 확인

```sh
# netstat -nltpu
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      1/systemd
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      629/nginx: master p
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      606/sshd
tcp6       0      0 :::111                  :::*                    LISTEN      1/systemd
# nginx가 80 포트를 사용 중
tcp6       0      0 :::80                   :::*                    LISTEN      629/nginx: master p
tcp6       0      0 :::22                   :::*                    LISTEN      606/sshd
udp        0      0 0.0.0.0:111             0.0.0.0:*                           1/systemd
udp        0      0 127.0.0.1:323           0.0.0.0:*                           566/chronyd
udp6       0      0 :::111                  :::*                                1/systemd
udp6       0      0 ::1:323                 :::*                                566/chronyd
```



디스크 사이즈 비교 sh

```sh
#!/bin/bash

# 디스크 사이즈를 SIZE에 저장
SIZE=$(du -m /var/log/nginx | awk '{print $1}')

echo ${SIZE}

# SIZE가 1024 메가바이트 보다 크면 then 작으면 else 출력
if [ ${SIZE} -ge 1024 ]
then
	echo "여기에 관리자에게 알리는 코드가 들어갑니다"
else
	echo "여기에는 아무 것도 안할거에요"
fi
```

- `$()`: () 안의 스크립트는 출력되지 않는 사일런트 명령어

텔레그램 봇 만들기

[생성 및 사용 방법 참고 사이트](https://chicpro.dev/telegram%ED%85%94%EB%A0%88%EA%B7%B8%EB%9E%A8-%EB%B4%87%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%B4-%EB%A9%94%EC%84%B8%EC%A7%80-%EC%A0%84%EC%86%A1%ED%95%98%EA%B8%B0/)



텔레그램 봇 API sh

```sh

```







